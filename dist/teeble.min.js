/*!
* teeble - v0.2.0 - 2013-03-06
* https://github.com/HubSpot/teeble
* Copyright (c) 2013 HubSpot, Marc Neuwirth, Jonathan Kim;
* Licensed MIT 
*/
(function(){this.Teeble={}}).call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};this.Teeble.TableRenderer=function(){function t(t){this.render_pagination=e(this.render_pagination,this),this.pagination_template=e(this.pagination_template,this),this.update_template=e(this.update_template,this),this.render_empty=e(this.render_empty,this),this.render_footer=e(this.render_footer,this),this.render_header=e(this.render_header,this),this.render_row=e(this.render_row,this),this.render_rows=e(this.render_rows,this),this.render=e(this.render,this),this.print_log=e(this.print_log,this),this._log_time=e(this._log_time,this),this._render=e(this._render,this),this._parse_data=e(this._parse_data,this),this._initialize=e(this._initialize,this),this._initialize(t),this}return t.prototype.debug=!1,t.prototype.log=[],t.prototype.key="rows",t.prototype.hasFooter=!1,t.prototype.data=null,t.prototype.header_template=null,t.prototype.row_template=null,t.prototype.rows_template=null,t.prototype.table_class=null,t.prototype.table_template=null,t.prototype.table_template_compiled=null,t.prototype.empty_message="No data to display",t.prototype.classes={sorting:{sortable_class:"sorting"},pagination:{pagination_class:"pagination",pagination_active:"active",pagination_disabled:"disabled"}},t.prototype._now=function(){return Date.now?Date.now():+(new Date)},t.prototype._initialize=function(e){var t,n,r,i;this.start=this._now(),this.options=e,n=["table_class","debug","key","partials","data","hasFooter","pagination_template","empty_message","cid","classes","collection"];for(r=0,i=n.length;r<i;r++)t=n[r],this.options[t]&&(this[t]=this.options[t]);this._log_time("start"),this.partials&&(this._log_time("generate partials"),this.update_template(this.partials));if(this.data)return this.render(this.data)},t.prototype._parse_data=function(e){var t,n;return e&&(Backbone&&e instanceof Backbone.Collection?(n={},n[this.key]=e.toJSON(),this.data=n):e[this.key]?this.data=e:e instanceof Array?(n={},e=function(){var n,r,i;i=[];for(n=0,r=e.length;n<r;n++)t=e[n],Backbone&&t instanceof Backbone.Model?i.push(t.toJSON()):i.push(t);return i}(),n[this.key]=e,this.data=n):(n={},n[this.key]=[e],this.data=n)),this.data?!0:(console.log("could not parse data"),!1)},t.prototype._render=function(e,t){return t==null&&(t=this.data),e?t?(this._log_time("start compile"),this.rendered=e(t),this._log_time("end compile"),this.rendered):(console.log("no data"),!1):(console.log("no compiled template"),!1)},t.prototype._log_time=function(e){if(this.debug)return this.log.push(""+(this._now()-this.start)+"ms: "+e)},t.prototype.print_log=function(){return console.log(this.log)},t.prototype.render=function(e){if(this._parse_data(e))return this._render(this.table_template_compiled)},t.prototype.render_rows=function(e){this.rows_template_compiled||(this.rows_template_compiled=Handlebars.compile(this.rows_template));if(this._parse_data(e))return this._render(this.rows_template_compiled)},t.prototype.render_row=function(e){this.row_template_compiled||(this.row_template_compiled=Handlebars.compile(this.row_template));if(e)return this._render(this.row_template_compiled,e)},t.prototype.render_header=function(e){this.header_template_compiled||(this.header_template_compiled=Handlebars.compile(this.header_template));if(e)return this._render(this.header_template_compiled,e)},t.prototype.render_footer=function(e){this.footer_template_compiled||(this.footer_template_compiled=Handlebars.compile(this.footer_template));if(e)return this._render(this.footer_template_compiled,e)},t.prototype.render_empty=function(e){this.table_empty_template_compiled||(this.table_empty_template_compiled=Handlebars.compile(this.table_empty_template));if(e)return e.message||(e.message=this.empty_message),this._render(this.table_empty_template_compiled,e)},t.prototype.update_template=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k;e==null&&(e=this.partials),this._log_time("generate master template"),o="",v="",r="",f=0;for(d in e){p=e[d];if(p.header){b=void 0;if(typeof p.header=="string")b=p.header,u="";else{p.header.template&&(b=p.header.template),u="<th",p.header.attributes||(p.header.attributes={}),p.sortable&&(p.header.attributes["data-sort"]=p.sortable,p.header.attributes["class"]?(typeof p.header.attributes["class"]=="string"&&(p.header.attributes["class"]=[p.header.attributes["class"]]),p.header.attributes["class"].push(this.classes.sorting.sortable_class)):p.header.attributes["class"]=[this.classes.sorting.sortable_class]),x=p.header.attributes;for(t in x)w=x[t],w instanceof Array&&(w=w.join(" ")),u+=" "+t+'="'+w+'" ';u+=">"}b&&(a=""+this.cid+"-header"+f,Handlebars.registerPartial(a,b),u+="{{> "+a+" }}"),p.header!==b&&(u+="</th>"),o+=u}if(p.footer){b=void 0;if(typeof p.footer=="string")b=p.footer,i="";else{p.footer.template&&(b=p.footer.template),i="<td",p.footer.attributes||(p.footer.attributes={}),T=p.footer.attributes;for(t in T)w=T[t],w instanceof Array&&(w=w.join(" ")),i+=" "+t+'="'+w+'" ';i+=">"}b&&(s=""+this.cid+"-footer"+f,Handlebars.registerPartial(s,b),i+="{{> "+s+" }}"),p.footer!==b&&(i+="</td>"),r+=i}if(p.cell){b=void 0;if(typeof p.cell=="string")b=p.cell,m="";else{p.cell.template&&(b=p.cell.template),m="<td",p.cell.attributes||(p.cell.attributes={}),p.sortable&&(p.cell.attributes["data-sort"]=p.sortable),N=p.cell.attributes;for(t in N)w=N[t],w instanceof Array&&(w=w.join(" ")),m+=" "+t+'="'+w+'" ';m+=">"}b&&(g=""+this.cid+"-partial"+f,Handlebars.registerPartial(g,b),m+="{{> "+g+" }}"),p.cell!==b&&(m+="</td>"),v+=m}f++}l=0;if(this.collection.sortbarColumns){C=this.collection.sortbarColumns;for(E=0,S=C.length;E<S;E++){n=C[E],u='<th><select data-column="'+l+'" class="sortbar-column sortbar-column-'+l+'">',c=0;if(this.collection.sortbarColumnOptions){k=this.collection.sortbarColumnOptions;for(w in k)h=k[w],y="",w===n&&(y="selected",i="<td>{{"+w+"}}</td>",m="<td>{{"+w+"}}</td>"),u+='<option value="'+w+'" '+y+">"+h+"</option>",c++;u+="</select></th>",o+=u,r+=i,v+=m,l++}}}return this.header_template="<tr>"+o+"</tr>",this.footer_template=r,this.row_template=v,this.rows_template="{{#each "+this.key+"}}<tr>"+this.row_template+"</tr>{{/each}}",this.table_empty_template='<td valign="top" colspan="'+f+'" class="teeble_empty">{{message}}</td>',this.table_template||(this.table_template='<table class="'+this.table_class+'">\n<thead>'+this.header_template+"</thead>\n<tbody>"+this.row_template+"</tbody>\n{{#if "+this.hasFooter+"}}\n<tfoot>"+this.footer_template+"<tfoot>\n{{/if}}\n</table>"),this.table_template_compiled=Handlebars.compile(this.table_template),this.table_template_compiled=null,this.rows_template_compiled=null,this.row_template_compiled=null,this.header_template_compiled=null,this.footer_template_compiled=null,this.table_empty_template_compiled=null},t.prototype.pagination_template_compiled=null,t.prototype.pagination_template=function(){return'<div class="{{pagination_class}}">\n    <ul>\n        <li><a href="#" class="pagination-previous previous {{#if prev_disabled}}'+this.classes.pagination.pagination_disabled+'{{/if}}">Previous</a></li>\n        {{#each pages}}\n        <li><a href="#" class="pagination-page {{#if active}}'+this.classes.pagination.pagination_active+'{{/if}}" data-page="{{number}}">{{number}}</a></li>\n        {{/each}}\n        <li><a href="#" class="pagination-next next {{#if next_disabled}}'+this.classes.pagination.pagination_disabled+'{{/if}}">Next</a></li>\n    </ul>\n</div>'},t.prototype.render_pagination=function(e){return this.pagination_template_compiled||(this.pagination_template_compiled=Handlebars.compile(this.pagination_template())),this.pagination_template_compiled(e)},t}()}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};this.Teeble.EmptyView=function(t){function r(){return this.render=e(this.render,this),this.initialize=e(this.initialize,this),r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.initialize=function(){return this.renderer=this.options.renderer,this.collection.bind("destroy",this.remove,this)},r.prototype.render=function(){return this.renderer&&(this.el=this.renderer.render_empty(this.options)),this},r}(Backbone.View)}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};this.Teeble.FooterView=function(t){function r(){return this.render=e(this.render,this),this.initialize=e(this.initialize,this),r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.tagName="tfoot",r.prototype.initialize=function(){return this.renderer=this.options.renderer,this.collection.bind("destroy",this.remove,this)},r.prototype.render=function(){return this.renderer&&this.$el.html(this.renderer.render_footer({})),this},r}(Backbone.View)}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};this.Teeble.HeaderView=function(t){function r(){return this.setSort=e(this.setSort,this),this.render=e(this.render,this),this.initialize=e(this.initialize,this),r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.tagName="thead",r.prototype.initialize=function(){return this.renderer=this.options.renderer,this.classes=this.options.classes,this.collection.bind("destroy",this.remove,this),this.collection.bind("reset",this.setSort,this)},r.prototype.render=function(){return this.renderer&&(this.$el.html(this.renderer.render_header(this.options)),this.setSort()),this},r.prototype.setSort=function(){var e,t;if(this.collection.sortColumn)return t="desc",this.collection.sortDirection&&(t=this.collection.sortDirection),e="sorted_"+t+"_class",this.$el.find("."+this.classes.sorting.sortable_class).removeClass(""+this.classes.sorting.sorted_desc_class+" "+this.classes.sorting.sorted_asc_class).filter('.sorting[data-sort="'+this.collection.sortColumn+'"]').addClass(""+this.classes.sorting[e])},r}(Backbone.View)}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};this.Teeble.PaginationView=function(t){function r(){return this.render=e(this.render,this),this.initialize=e(this.initialize,this),r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.tagName="div",r.prototype.initialize=function(){return this.renderer=this.options.renderer,this.collection.bind("destroy",this.remove,this)},r.prototype.render=function(){var e,t,n,r,i;return this.renderer&&(t=this.collection.info(),t.totalPages>1&&(i=function(){var e,i,s,o;s=t.pageSet,o=[];for(e=0,i=s.length;e<i;e++)r=s[e],n={active:r===t.currentPage?this.options.pagination.pagination_active:void 0,number:r},o.push(n);return o}.call(this),e={pagination_class:this.options.pagination.pagination_class,pagination_disabled:this.options.pagination.pagination_disabled,prev_disabled:t.previous===!1||t.hasPrevious===!1,next_disabled:t.next===!1||t.hasNext===!1,pages:i},this.$el.html(this.renderer.render_pagination(e)))),this},r}(Backbone.View)}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};this.Teeble.RowView=function(t){function r(){return this.render=e(this.render,this),this.initialize=e(this.initialize,this),r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.tagName="tr",r.prototype.initialize=function(){return this.renderer=this.options.renderer,this.model.bind("change",this.render,this),this.model.bind("destroy",this.remove,this)},r.prototype.render=function(){return this.renderer&&this.$el.html(this.renderer.render_row(this.model.toJSON({teeble:!0}))),this},r}(Backbone.View)}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};this.Teeble.SortbarView=function(t){function r(){return this.render=e(this.render,this),this.initialize=e(this.initialize,this),r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.tagName="thead",r.prototype.template='<tr>\n    <% _.each(partials, function(partial) { %>\n        <%= partial.header %>\n    <% }); %>\n    <% for(var i = 0; i < sortbarColumns; i++) { %>\n        <th>\n            <select class="column-<%= i %>" >\n                <% _.each(sortbarColumnOptions, function(name, value) { %>\n                    <option value="<%= value %>" ><%= name %></option>\n                <% }); %>\n            </select>\n        </th>\n    <% } %>\n</tr>',r.prototype.initialize=function(){return this.renderer=this.options.renderer,this.collection.bind("destroy",this.remove,this)},r.prototype.render=function(){var e;return this.renderer&&(e=_.template(this.template,{partials:this.options.renderer.partials,sortbarColumns:this.options.collection.sortbarColumns,sortbarColumnOptions:this.options.collection.sortbarColumnOptions}),this.$el.html(e)),this},r}(Backbone.View)}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};this.Teeble.TableView=function(t){function r(){return this.sortBarChange=e(this.sortBarChange,this),this.sort=e(this.sort,this),this._sort=e(this._sort,this),this.gotoPage=e(this.gotoPage,this),this.gotoLast=e(this.gotoLast,this),this.gotoNext=e(this.gotoNext,this),this.gotoPrev=e(this.gotoPrev,this),this.gotoFirst=e(this.gotoFirst,this),this.addOne=e(this.addOne,this),this.renderEmpty=e(this.renderEmpty,this),this.renderBody=e(this.renderBody,this),this.renderFooter=e(this.renderFooter,this),this.renderHeader=e(this.renderHeader,this),this.renderPagination=e(this.renderPagination,this),this.render=e(this.render,this),this.setOptions=e(this.setOptions,this),this.initialize=e(this.initialize,this),r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.tagName="div",r.prototype.classes={sorting:{sortable_class:"sorting",sorted_desc_class:"sorting_desc",sorted_asc_class:"sorting_asc"},pagination:{pagination_class:"pagination",pagination_active:"active",pagination_disabled:"disabled"}},r.prototype.subviews={header:Teeble.HeaderView,row:Teeble.RowView,footer:Teeble.FooterView,pagination:Teeble.PaginationView,renderer:Teeble.TableRenderer,empty:Teeble.EmptyView},r.prototype.initialize=function(){return this.subviews=_.extend({},this.subviews,this.options.subviews),this.events=_.extend({},this.events,{"click a.first":"gotoFirst","click a.previous":"gotoPrev","click a.next":"gotoNext","click a.last":"gotoLast","click a.pagination-page":"gotoPage","click .sorting":"sort","change .sortbar-column":"sortBarChange"}),this.setOptions(),r.__super__.initialize.apply(this,arguments),this.collection.on("add",this.addOne,this),this.collection.on("reset",this.renderBody,this),this.collection.on("reset",this.renderPagination,this),this.renderer=new this.subviews.renderer({partials:this.options.partials,collection:this.collection,table_class:this.options.table_class,cid:this.cid,classes:this.classes})},r.prototype.setOptions=function(){return this},r.prototype.render=function(){return this.$el.empty().append("<table><tbody></tbody></table"),this.table=this.$("table").addClass(this.options.table_class),this.body=this.$("tbody"),this.renderHeader(),this.renderBody(),this.renderFooter(),this.renderPagination(),this.trigger("teeble.render",this),this},r.prototype.renderPagination=function(){var e;if(this.options.pagination)return(e=this.pagination)!=null&&e.remove(),this.pagination=new this.subviews.pagination({renderer:this.renderer,collection:this.collection,pagination:this.classes.pagination}),this.$el.append(this.pagination.render().el),this.trigger("pagination.render",this)},r.prototype.renderHeader=function(){var e;return(e=this.header)!=null&&e.remove(),this.header=new this.subviews.header({renderer:this.renderer,collection:this.collection,classes:this.classes}),this.table.prepend(this.header.render().el),this.trigger("header.render",this)},r.prototype.renderFooter=function(){var e;if(this.options.footer){(e=this.footer)!=null&&e.remove();if(this.collection.length>0)return this.footer=new this.subviews.footer({renderer:this.renderer,collection:this.collection}),this.table.append(this.footer.render().el),this.trigger("footer.render",this)}},r.prototype.renderBody=function(){return this.body.empty(),this.collection.length>0?this.collection.each(this.addOne):this.renderEmpty(),this.trigger("body.render",this)},r.prototype.renderEmpty=function(){return this.empty=new this.subviews.empty({renderer:this.renderer,collection:this.collection}),this.body.append(this.empty.render().el),this.trigger("empty.render",this)},r.prototype.addOne=function(e){var t;return t=new this.subviews.row({model:e,renderer:this.renderer}),this.body.append(t.render().el),this.trigger("row.render",t)},r.prototype.gotoFirst=function(e){return e.preventDefault(),this.collection.goTo(1)},r.prototype.gotoPrev=function(e){return e.preventDefault(),this.collection.previousPage()},r.prototype.gotoNext=function(e){return e.preventDefault(),this.collection.nextPage()},r.prototype.gotoLast=function(e){return e.preventDefault(),this.collection.goTo(this.collection.information.lastPage)},r.prototype.gotoPage=function(e){var t;return e.preventDefault(),t=this.$(e.target).text(),this.collection.goTo(t)},r.prototype._sort=function(e,t){var n,r;return e.preventDefault(),n=this.$(e.target),n.hasClass(this.classes.sorting.sortable_class)||(n=n.parents("."+this.classes.sorting.sortable_class)),r=n.attr("data-sort"),this.collection.setSort(r,t)},r.prototype.sort=function(e){var t;return t=this.$(e.currentTarget),t.hasClass(this.classes.sorting.sorted_desc_class)?this._sort(e,"asc"):this._sort(e,"desc")},r.prototype.sortBarChange=function(e){var t,n,r;return t=this.$(e.currentTarget),n=t.attr("data-column"),r=t.val(),this.collection.sortbarColumns[~~n]=r,this.renderer.update_template(),this.render()},r}(Backbone.View)}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};this.Teeble.ClientCollection=function(t){function r(){return this.whereAll=e(this.whereAll,this),this.initialize=e(this.initialize,this),r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.default_paginator_core={dataType:"json",url:function(){return this.url()}},r.prototype.default_paginator_ui={sortColumn:"",sortDirection:"desc",firstPage:1,currentPage:1,perPage:10,pagesInRange:3},r.prototype.initialize=function(){return this.paginator_ui=_.extend({},this.default_paginator_ui,this.paginator_ui),this.paginator_core=_.extend({},this.default_paginator_core,this.paginator_core),r.__super__.initialize.apply(this,arguments)},r.prototype.whereAll=function(e){return _.isEmpty(e)?[]:_.filter(this.origModels,function(t){var n,r;for(n in e){r=e[n];if(r!==t.get(n))return!1}return!0})},r}(Backbone.Paginator.clientPager)}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};this.Teeble.ServerCollection=function(t){function r(){return this.pager=e(this.pager,this),this.setSort=e(this.setSort,this),this.previousPage=e(this.previousPage,this),this.nextPage=e(this.nextPage,this),this.initialize=e(this.initialize,this),r.__super__.constructor.apply(this,arguments)}return n(r,t),r.prototype.default_paginator_core={dataType:"json",url:function(){return this.url()}},r.prototype.default_paginator_ui={firstPage:1,currentPage:1,perPage:10,pagesInRange:3},r.prototype.default_server_api={offset:function(){return(this.currentPage-1)*this.perPage},limit:function(){return this.perPage}},r.prototype.initialize=function(){return this.paginator_ui=_.extend({},this.default_paginator_ui,this.paginator_ui),this.paginator_core=_.extend({},this.default_paginator_core,this.paginator_core),this.server_api=_.extend({},this.default_server_api,this.server_api),r.__super__.initialize.apply(this,arguments)},r.prototype.nextPage=function(e){if(this.currentPage<this.information.totalPages)return this.promise=this.requestNextPage(e)},r.prototype.previousPage=function(e){if(this.currentPage>1)return this.promise=this.requestPreviousPage(e)},r.prototype.setSort=function(e,t){if(e!==void 0&&t!==void 0)return this.lastSortColumn=this.sortColumn,this.sortColumn=e,this.sortDirection=t,this.pager(),this.info()},r.prototype.pager=function(){return this.lastSortColumn!==this.sortColumn&&(this.currentPage=1,this.lastSortColumn=this.sortColumn),r.__super__.pager.apply(this,arguments)},r}(Backbone.Paginator.requestPager)}.call(this);