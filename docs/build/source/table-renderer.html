<!DOCTYPE html>

<html>
<head>
  <title>table-renderer.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="setup.html">
                setup.coffee
              </a>
            
              
              <a class="source" href="table-renderer.html">
                table-renderer.coffee
              </a>
            
              
              <a class="source" href="teeble.html">
                teeble.coffee
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>table-renderer.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="class"><span class="keyword">class</span> @<span class="title">Teeble</span>.<span class="title">TableRenderer</span></span>
    key: <span class="string">'rows'</span>
    hasFooter: <span class="literal">false</span>
    data: <span class="literal">null</span>
    header_template: <span class="literal">null</span>
    row_template: <span class="literal">null</span>
    rows_template: <span class="literal">null</span>
    table_class: <span class="literal">null</span>
    table_template: <span class="literal">null</span>
    table_template_compiled: <span class="literal">null</span>
    empty_message: <span class="string">"No data to display"</span>

    classes:
        sorting:
            sortable_class: <span class="string">'sorting'</span>

    compile: _.template

    _initialize: =&gt;
        validOptions = [
            <span class="string">'table_class'</span>
            <span class="string">'partials'</span>
            <span class="string">'hasFooter'</span>
            <span class="string">'empty_message'</span>
            <span class="string">'cid'</span>
            <span class="string">'classes'</span>
            <span class="string">'compile'</span>
        ]

        <span class="keyword">for</span> option <span class="keyword">in</span> validOptions
            <span class="keyword">if</span> <span class="property">@options</span>[option]?
                @[option] = <span class="property">@options</span>[option]

        <span class="keyword">if</span> <span class="property">@partials</span>
            <span class="property">@update_template</span>(<span class="property">@partials</span>)

    _getExtraData: =&gt;
        {}

    _render: (template, data) =&gt;
        <span class="keyword">if</span> <span class="keyword">not</span> template
            console.log <span class="string">'no compiled template'</span>
            <span class="keyword">return</span> <span class="literal">false</span>
        <span class="keyword">if</span> <span class="keyword">not</span> data
            console.log <span class="string">'no data'</span>
            <span class="keyword">return</span> <span class="literal">false</span>
        <span class="keyword">else</span>
            data = _.extend {}, <span class="property">@_getExtraData</span>(), data
            <span class="keyword">return</span> template(data)

    constructor: (<span class="property">@options</span>) -&gt;
        <span class="property">@_initialize</span>()
        @

    render_row: (data) =&gt;
        <span class="keyword">if</span> <span class="keyword">not</span> <span class="property">@row_template_compiled</span>
            <span class="property">@row_template_compiled</span> = <span class="property">@compile</span>(<span class="property">@row_template</span>)
        <span class="keyword">if</span> data
            <span class="property">@_render</span>(<span class="property">@row_template_compiled</span>, data)

    render_header: (data) =&gt;
        <span class="keyword">if</span> <span class="keyword">not</span> <span class="property">@header_template_compiled</span>
            <span class="property">@header_template_compiled</span> = <span class="property">@compile</span>(<span class="property">@header_template</span>)
        <span class="keyword">if</span> data
            <span class="property">@_render</span>(<span class="property">@header_template_compiled</span>, data)


    render_footer: (data) =&gt;
        <span class="keyword">if</span> <span class="keyword">not</span> <span class="property">@footer_template_compiled</span>
            <span class="property">@footer_template_compiled</span> = <span class="property">@compile</span>(<span class="property">@footer_template</span>)
        <span class="keyword">if</span> data
            <span class="property">@_render</span>(<span class="property">@footer_template_compiled</span>, data)

    render_empty: (data) =&gt;
        <span class="keyword">if</span> <span class="keyword">not</span> <span class="property">@table_empty_template_compiled</span>
            <span class="property">@table_empty_template_compiled</span> = <span class="property">@compile</span>(<span class="property">@table_empty_template</span>)
        <span class="keyword">if</span> data
            <span class="keyword">if</span> <span class="keyword">not</span> data.message
                data.message = <span class="property">@empty_message</span>
            <span class="property">@_render</span>(<span class="property">@table_empty_template_compiled</span>, data)

    _get_template_attributes: (type, partial, i) -&gt;
        sortable = partial.sortable
        section = partial[type]
        wrap = <span class="literal">false</span>

        <span class="keyword">if</span> <span class="keyword">typeof</span> section <span class="keyword">is</span> <span class="string">'string'</span>
            template = section

        <span class="keyword">else</span>
            wrap = <span class="literal">true</span>
            <span class="keyword">if</span> section.template
                template = section.template

            <span class="keyword">if</span> <span class="keyword">not</span> section.attributes
                section.attributes = {}
            <span class="keyword">if</span> sortable
                section.attributes[<span class="string">'data-sort'</span>] = sortable

                <span class="keyword">if</span> <span class="keyword">not</span> section.attributes.<span class="class"><span class="keyword">class</span>
                    <span class="title">section</span>.<span class="title">attributes</span>.<span class="title">class</span> = [@<span class="title">classes</span>.<span class="title">sorting</span>.<span class="title">sortable_class</span>]</span>
                <span class="keyword">else</span>
                    <span class="keyword">if</span> <span class="keyword">typeof</span> section.attributes.<span class="class"><span class="keyword">class</span> <span class="title">is</span> '<span class="title">string</span>'</span>
                        section.attributes.<span class="class"><span class="keyword">class</span> = [<span class="title">section</span>.<span class="title">attributes</span>.<span class="title">class</span>]</span>
                    section.attributes.class.push(<span class="property">@classes</span>.sorting.sortable_class)

            attributes = []
            <span class="keyword">for</span> attribute, value <span class="keyword">of</span> section.attributes
                <span class="keyword">if</span> value <span class="keyword">instanceof</span> Array
                    value = value.join(<span class="string">' '</span>)
                attributes.push
                    name: attribute
                    value: value

        <span class="keyword">if</span> template
            attributes: attributes
            wrap: wrap
            partial: template
        <span class="keyword">else</span>
            attributes: {}
            wrap: wrap
            partial: <span class="string">''</span>

    _generate_template: (name, columns, wrap, td = <span class="string">'td'</span>) -&gt;
        str = <span class="string">""</span>
        <span class="keyword">if</span> columns
            <span class="keyword">for</span> column_name, column <span class="keyword">of</span> columns
                section = column[name]
                <span class="keyword">if</span> section
                    column_template = <span class="string">"<span class="subst">#{section.partial}</span>"</span>

                    <span class="keyword">if</span> section.wrap
                        attributes = <span class="string">''</span>
                        <span class="keyword">if</span> section.attributes?.length
                            <span class="keyword">for</span> attribute <span class="keyword">in</span> section.attributes
                                attributes += <span class="string">"""<span class="subst">#{attribute.name}</span>="<span class="subst">#{attribute.value}</span>" """</span>

                        column_template = <span class="string">"&lt;<span class="subst">#{td}</span> <span class="subst">#{attributes}</span>&gt;<span class="subst">#{column_template}</span>&lt;/<span class="subst">#{td}</span>&gt;"</span>

                    str += column_template

            <span class="keyword">if</span> wrap
                str = <span class="string">"&lt;<span class="subst">#{wrap}</span>&gt;<span class="subst">#{str}</span>&lt;/<span class="subst">#{wrap}</span>&gt;"</span>
        str

    generate_columns: (partials = <span class="property">@partials</span>, clear = <span class="literal">false</span>) =&gt;
        <span class="keyword">if</span> <span class="property">@columns</span> <span class="keyword">and</span> <span class="keyword">not</span> clear
            <span class="keyword">return</span> <span class="property">@columns</span>
        <span class="keyword">else</span>
            i = <span class="number">0</span>
            <span class="property">@columns</span> = []
            <span class="keyword">for</span> partial_name, partial <span class="keyword">of</span> partials
                column = {}</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2>Header</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="keyword">if</span> partial.header
                    column.header = <span class="property">@_get_template_attributes</span>(<span class="string">'header'</span>, partial, i)</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h2>Footer</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="keyword">if</span> partial.footer
                    column.footer = <span class="property">@_get_template_attributes</span>(<span class="string">'footer'</span>, partial, i)</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h2>Cell</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="keyword">if</span> partial.cell
                    column.cell = <span class="property">@_get_template_attributes</span>(<span class="string">'cell'</span>, partial, i)

                <span class="property">@columns</span>.push column

                i++
            <span class="keyword">return</span> <span class="property">@columns</span>


    update_template: (partials = <span class="property">@partials</span>) =&gt;
        columns = <span class="property">@generate_columns</span>()

        <span class="property">@header_template</span> = <span class="property">@_generate_template</span>(<span class="string">'header'</span>, columns, <span class="string">'tr'</span>, <span class="string">'th'</span>)
        <span class="property">@footer_template</span> = <span class="property">@_generate_template</span>(<span class="string">'footer'</span>, columns, <span class="string">'tr'</span>)
        <span class="property">@row_template</span> = <span class="property">@_generate_template</span>(<span class="string">'cell'</span>, columns)
        <span class="property">@table_empty_template</span> = <span class="string">"""&lt;td valign="top" colspan="<span class="subst">#{columns.length}</span>" class="teeble_empty"&gt;{{message}}&lt;/td&gt;"""</span></pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
